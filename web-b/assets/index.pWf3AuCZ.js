import{b as e,c as t,a as s,h as a,d as o,r,f as i,o as n,q as p,k as l,w as c,m as u,t as d,y as h,F as m,u as w,j as _,I as f,x as g,i as y,z as P}from"./index-DvIUTlip.js";import{r as C,_ as b}from"./index.CfQBTuy4.js";import{p as I,a as x,g as k,b as v,d as T,w as D,_ as $}from"./check.gP0nHnZq.js";import{_ as L}from"./_plugin-vue_export-helper.BCo6x5W8.js";const S=L({props:{params:{type:Object,default:()=>({})}},data:()=>({account:null,powersID:null,powersList:[],powerValue:null,currencySum:null,qrCodeBase64:"",popupType:"bottom",second:30,start:!0,timer:null}),onShow:function(){},watch:{powerValue(e){this.getPricePowers()}},methods:{getPricePowers(){I({amount:Number(this.powerValue)}).then((e=>{2e4==e.code&&(this.currencySum=e.data.currency)}))},goProductPage(){e().windowWidth,this.popupType=e().windowWidth<768?"bottom":"center",this.$refs.popup.open(this.popupType),this.getUserPower(),this.getPowersOptions()},getPowersOptions(){x().then((e=>{2e4==e.code&&(this.powersList=e.data.PowerPurchaseOptions,this.powersID=this.powersList[0].ID,this.powerValue=this.powersList[0].PowerAmount)}))},changePower(e){this.powersID=e.ID,this.powerValue=e.PowerAmount},getUserPower(){k().then((e=>{2e4==e.code&&(this.account=e.data.account)}))},async createQRCode(e){try{this.qrCodeBase64=await v.toDataURL(e),this.$refs.popupcenter.open("center")}catch(t){console.error("生成二维码失败:",t)}},getUserInfo(){userInfo().then((e=>{2e4==e.code&&(this.userInfo=e.data.userInfo)}))},skewChange(e){this.getTransactionsList(),this.skewIndex=e},getTransactionsList(){transactionsList().then((e=>{2e4==e.code&&(this.depositList=e.data.transactions.Deposit||[],this.withdrawList=e.data.transactions.Withdraw||[])}))},handleWePay(){this.clearTimer(),t({title:"加载中",mask:!0}),Boolean(s("isChinese"));let e="";switch(s("uniPlatform")){case"mp-weixin":e="mp-weixin";break;case"web":e="wechat"}e=Boolean(s("isChinese"))?"wechat":"stripe";let i={amount:this.powerValue,payment_method:e,currency:"CNY"};T(i).then((e=>{if(2e4==e.code)if(a(),Boolean(s("isChinese")))switch(s("uniPlatform")){case"mp-weixin":uni.requestPayment({provider:"wxpay",timeStamp:e.data.timeStamp,nonceStr:e.data.nonceStr,package:"prepay_id="+e.data.prepayid,signType:e.data.signType,paySign:e.data.paySign,success:function(e){o({icon:"success",title:"支付成功"}),r({url:"/pages/web/web18GpuProduct"})},fail:function(e){console.log("fail:"+JSON.stringify(e)),o({icon:"error",title:"支付失败"})}});break;case"web":this.createQRCode(e.data.url),this.getResult(e.data.id)}else window.location.href=e.data.url;else a()}))},getResult(e){this.timer=setInterval((()=>{this.second>0&&(this.second--,D(e).then((e=>{2e4==e.code&&"completed"==e.data.transaction.status&&(this.start=!1,o({icon:"success",title:"支付成功！"}),this.$refs.popupcenter.close(),this.$refs.popup.close(),this.getUserPower())})),(this.second<1||!this.start)&&(this.start=!1,o({icon:"none",title:"支付失败！"}),this.$refs.popupcenter.close(),this.clearTimer()))}),1e3)},clearTimer(){this.timer&&(clearInterval(this.timer),this.timer=null)}},beforeUnmount(){this.clearTimer()}},[["render",function(e,t,s,a,o,r){const I=_,x=f,k=g,v=C(i("uni-popup"),b);return n(),p(m,null,[l(v,{ref:"popup",type:o.popupType,class:"popupDiv"},{default:c((()=>[l(I,{id:"formDom",style:{"background-color":"aliceblue"}}),l(I,{class:"flex column alignCenter pop_div"},{default:c((()=>[l(I,{class:"pop_header_div"},{default:c((()=>[l(I,{class:"pop_header_text"},{default:c((()=>[u(d(e.$t("14_Top_up")),1)])),_:1})])),_:1}),l(I,{class:"pop_header_label"},{default:c((()=>[u(d(e.$t("14_remaining_power"))+" ",1),h("span",{class:"pop_header_value"},d(o.account),1)])),_:1}),l(I,{class:"flex row justifyCenter pop_item_div"},{default:c((()=>[(n(!0),p(m,null,w(o.powersList,((t,s)=>(n(),y(I,{class:P(["flex row justifyBetween alignCenter pop_item",o.powersID==t.ID?"pop_item_selected":""]),key:t.ID,onClick:e=>r.changePower(t)},{default:c((()=>[l(I,{class:"flex column justifyCenter alignCenter"},{default:c((()=>[l(I,{class:"pop_item_value"},{default:c((()=>[u(d(t.PowerAmount),1)])),_:2},1024),l(I,{class:"pop_item_label"},{default:c((()=>[u(d(e.$t("14_Computing_power")),1)])),_:1})])),_:2},1024),l(I,{class:"pop_item_money"},{default:c((()=>[u("¥"+d(t.AmountInCurrency),1)])),_:2},1024)])),_:2},1032,["class","onClick"])))),128))])),_:1}),l(x,{class:"custome_input",type:"number",placeholder:e.$t("14_Customize"),modelValue:o.powerValue,"onUpdate:modelValue":t[0]||(t[0]=e=>o.powerValue=e)},null,8,["placeholder","modelValue"]),l(I,{class:"pay_btn",onClick:t[1]||(t[1]=e=>r.handleWePay())},{default:c((()=>[u("¥"+d(o.currencySum)+" "+d(e.$t("14_Pay_now")),1)])),_:1}),l(I,{class:"flex row alignCenter agreement_div"},{default:c((()=>[l(k,{class:"btn_img",src:$}),l(I,{class:"agreement_text"},{default:c((()=>[u(d(e.$t("14_agree"))+" ",1),h("span",{class:"agreement_value"},d(e.$t("14_Agreement")),1)])),_:1})])),_:1})])),_:1})])),_:1},8,["type"]),l(v,{ref:"popupcenter",type:"center",animation:!1},{default:c((()=>[l(k,{src:o.qrCodeBase64,mode:"aspectFit"},null,8,["src"])])),_:1},512)],64)}],["__scopeId","data-v-b2a238ea"]]);export{S as P};
